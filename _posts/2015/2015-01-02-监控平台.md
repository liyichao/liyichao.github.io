---
layout: post
title: "监控平台"
category: 
tags: []
---
{% include JB/setup %}

监控是一个平台，它包括数据收集，存储，报警，展示，API。

## 收集

* collectd：收集系统指标如 CPU load，memory，disk usage，5.4.1 有 statsd 插件，用于收集应用的计时和计数数据。
* heka：通用数据采集和处理，可用于解析 nginx 日志，各状态码的计数，以及把日志发给 elasticsearch 用于实时搜索。
* pstatsd：python statsd 客户端库，应用程序计时和计数。
* kids：日志收集。

collectd 有很多插件，而 heka 的潜力也是很大，应用程序的计时和计数还不是特别积极和完善。

日志方面，应该如下组织：

* Transaction：表示持续一段时间的事件，如 URL 请求，RPC 调用。Transaction具有以下属性：
    
    * 类型：如 URL，RPC，SQL，或者 REDIS，一般用两级，如 URL-Handler，RPC-Service
    * 一系列 key-value 对。用于进一步表明 Transaction 的属性
    * 起止时间
    * 成功还是失败

* Event：表示某一时刻发生的值得注意的事件，如异常。Event 相当于平常的日志概念，它具有如下属性：

    * key-value 对
    * 消息体
    * timestamp
    * 状态：error，warning，info

## 存储

* Influxdb：metric 的存储

Metric 的序列化格式将不再是 `graphite protocol`：

    name value timestamp

一个 Metric 会有很多 tag，搜索 Metric 的时候可以通过 tag 搜索。这将导致以下改变：

* statsd library：应用程序可以为每个 Metric 加上 key-value 对了。
* 用于收集和聚合的 agent：部署在每台机器上的 statsd 可能会变，或者，statsd 客户端将 tag 映射到 metric 的名字上去，然后在存储端，再从名字解析出各 tag
* UI：可以通过 tag 查询指标

