<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Oracle 11gR1 默认设置调整</title>
    <meta name="author" content="kyle x lau" />
    <link href="http://kyle.xlau.org/atom.xml" rel="alternate" title="liyichao's Weblog" type="application/atom+xml" />

    <!-- Homepage CSS -->
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css" type="text/css" media="screen" charset="utf-8" />
    <link rel="stylesheet" href="/assets/css/bootstrap-responsive.css" type="text/css" media="screen" charset="utf-8" />
    <link rel="stylesheet" href="/assets/css/app.css" type="text/css" media="screen" charset="utf-8" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/assets/css/syntax.css" type="text/css" media="screen" charset="utf-8" />

    <link rel="shortcut icon" href="assets/ico/favicon.ico">
      <!-- Fonts -->
      <link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
      </head>

      <body>
	<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="/">Kylexlau's Weblog</a>
	<ul class="nav">
	  <li class="active"><a href="/">Home</a></li>
	  <li ><a href="/archive.html">Archive</a></li>
	  <li ><a href="/categories.html">Categories</a></li>
	  <li ><a href="/sitemap.html">Sitemap</a></li>
	  <li ><a href="/about.html">About</a></li>
	</ul>
	<ul class="nav pull-right">
	  <li ><a href="/atom.xml">Subscribe</a></li>
	</ul>
    </div>
  </div>
</div>

	<div class="container">
	  <div id="post">
<h1>
  <a href="/posts/11g-default-config.html">Oracle 11gR1 默认设置调整</a>
</h1>
<div class="authoring">
  December  8, 2011
</div>

<h2>默认没有设置LOCAL_LISTENER参数</h2>

<p>客户端登录会报错，ORA-12545: 因目标主机或对象不存在, 连接失败。有两种解决方法，一是改服务端配置（更好），二是改客户端。</p>

<h3>设置 LOCAL_LISTENER</h3>

<p>参考 MOS Notes ID 364855.1。</p>

<p>在两个实例上分别执行：</p>

<pre><code>SQL&gt; alter system set LOCAL_LISTENER="(address=(protocol=tcp)(port=1521)(host=&lt;your_vip_node1&gt;)) scope=both sid='INSTANCE_NAME1';
SQL&gt; alter system set LOCAL_LISTENER="(address=(protocol=tcp)(port=1521)(host=&lt;your_vip_node2&gt;)) scope=both sid='INSTANCE_NAME2';
</code></pre>

<p>注意your_vip_node1使用ip，如果使用主机名，还是需要在客户端修改hosts文件。</p>

<h3>修改客户端hosts文件</h3>

<p>添加类似:</p>

<pre><code>172.25.198.224 racnode1-vip
172.25.198.225 racnode2-vip
</code></pre>

<h2>默认使用ADR管理日志和跟踪文件</h2>

<p>ADR(Automatic Diagnostic Repository)是自动诊断信息库，11g新特性，用来统一管理Oracle相关的所有日志和跟踪文件。</p>

<p>由于监听相关的日志现在也由ADR统一管理了，导致alert log里会大量出现<code>TNS-12535: TNS:operation timed out</code>的报错信息。 11g之前，这类报错是写在sqlnet.log里的。</p>

<p>如果不想看到alert log里报错太多，可以将监听相关的日志改为11g前的记录方式：</p>

<ol>
<li>修改sqlnet.ora，添加： DIAG_ADR_ENABLED = OFF</li>
<li>修改listener.ora，添加： DIAG_ADR_ENABLED_<listenername> = OFF</li>
<li>重启或reload监听。</li>
</ol>


<p>这个其实不需要改，只需忽略TNS类的报错就是。改了，监听相关的故障就不能通过adrci工具来诊断了。</p>

<h2>默认密码策略</h2>

<p>默认一个用户10次登录失败，会锁定用户。如果某用户不停使用错误密码登录数据
库，会导致用户被锁定，使得业务受影响。应修改此策略为不限制。</p>

<pre><code>SQL&gt; alter profile default FAILED_LOGIN_ATTEMPTS unlimited;
</code></pre>

<p>默认一个用户密码如果超过180天不更改，也会锁定用户。如果你的DB密码不能经
常修改的话，此策略也应修改。</p>

<pre><code>SQL&gt; alter profile default PASSWORD_LIFE_TIME unlimited;
</code></pre>

<h2>默认审计设置</h2>

<p>在Oracle 11g中，审计功能（AUDIT_TRAIL）是默认开启的。审计数据记录在数据
库中的SYS.AUD$表上。11g以前的版本中，审计默认是关闭的。</p>

<p>如果你发现AUD$这个表比较大了，检查下是哪种审计占的空间：</p>

<pre><code>SQL&gt; select action_name,count(*) from dba_audit_trail group by action_name;
</code></pre>

<p>一般是LOGON和LOGOFF类型的审计最多。取消此类审计：</p>

<pre><code>SQL&gt; noaudit session whenever successful;
</code></pre>

<p>一般来说，如果空间不是占的特别多，此类审计还是保留为好。可以取消对一些
登录特别频繁的用户的审计，比如DBSNMP用户：</p>

<pre><code>SQL&gt; noaudit session by dbsnmp;
</code></pre>

<h2>默认维护窗口</h2>

<p>默认的维护窗口平时是22:00开始，持续4小时，周末6:00开始，持续20小时。</p>

<p>根据需要进行修改，比如7x24的系统，可以将维护窗口修改为每天0:00开始，持续4小时，周末也一样。</p>

<h2>参考</h2>

<ul>
<li>Client Connection to RAC Intermittently Fails-ORA-12545 TNS: Host or
Object Does not Exist (Doc ID 364855.1)</li>
<li>Fatal NI Connect Error 12170, &lsquo;TNS-12535: TNS:operation timed out&rsquo;
Reported in 11g Alert Log (Doc ID 1286376.1)</li>
<li>Using and Disabling the Automatic Diagnostic Repository (ADR) with
Oracle Net for 11g (Doc ID 454927.1)</li>
<li>Huge/Large/Excessive Number Of Audit Records Are Being Generated In
The Database (Doc ID 1171314.1)</li>
</ul>


</div>

<div id="related">
  <h2>Random Posts</h2>
  <ul class="posts">
    
      <li><span>08 Oct 2013</span> &raquo; <a href="/posts/first-post.html">stat</a></li>
    
      <li><span>26 Aug 2013</span> &raquo; <a href="/posts/aix-large-pages.html">Oracle 数据库在 AIX 平台上启用大内存页</a></li>
    
      <li><span>05 Jul 2012</span> &raquo; <a href="/posts/oracle-data-guard-part2.html">Oracle 11g Data Guard 物理备库快速配置指南（下）</a></li>
    
      <li><span>26 Jun 2012</span> &raquo; <a href="/posts/oracle-data-guard-part1.html">Oracle 11g Data Guard 物理备库快速配置指南（上）</a></li>
    
      <li><span>13 Apr 2012</span> &raquo; <a href="/posts/linux-sar.html">Linux 下使用 Sar 简介</a></li>
    
  </ul>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'xlau';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


	  <div id="footer">
  Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a> and <a href="http://twitter.github.com/bootstrap/">Bootstrap</a>.  Last updated at 2013-10-08 14:11:33 +0800.
</div>

	</div>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script src="/assets/js/app.js"></script>
	<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-4770949-2']);
  _gaq.push(['_setDomainName', 'xlau.org']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
      </body>
</html>
