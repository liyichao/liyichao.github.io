<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Oracle 手工建库(10g RAC)</title>
    <meta name="author" content="kyle x lau" />
    <link href="http://kyle.xlau.org/atom.xml" rel="alternate" title="liyichao's Weblog" type="application/atom+xml" />

    <!-- Homepage CSS -->
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css" type="text/css" media="screen" charset="utf-8" />
    <link rel="stylesheet" href="/assets/css/bootstrap-responsive.css" type="text/css" media="screen" charset="utf-8" />
    <link rel="stylesheet" href="/assets/css/app.css" type="text/css" media="screen" charset="utf-8" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/assets/css/syntax.css" type="text/css" media="screen" charset="utf-8" />

    <link rel="shortcut icon" href="assets/ico/favicon.ico">
      <!-- Fonts -->
      <link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
      </head>

      <body>
	<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="/">Kylexlau's Weblog</a>
	<ul class="nav">
	  <li class="active"><a href="/">Home</a></li>
	  <li ><a href="/archive.html">Archive</a></li>
	  <li ><a href="/categories.html">Categories</a></li>
	  <li ><a href="/sitemap.html">Sitemap</a></li>
	  <li ><a href="/about.html">About</a></li>
	</ul>
	<ul class="nav pull-right">
	  <li ><a href="/atom.xml">Subscribe</a></li>
	</ul>
    </div>
  </div>
</div>

	<div class="container">
	  <div id="post">
<h1>
  <a href="/posts/manaual-database-creation.html">Oracle 手工建库(10g RAC)</a>
</h1>
<div class="authoring">
  October 19, 2011
</div>

<h2>简介</h2>
<p>最权威的参考文档是MOS的文档Doc ID <a href=":https://supporthtml.oracle.com/ep/faces/secure/km/DocumentDisplay.jspx?id=240052.1">240052.1</a> 和 Doc ID <a href=":https://supporthtml.oracle.com/ep/faces/secure/km/DocumentDisplay.jspx?id=137288.1">137288.1</a> 。</p>
<p>大致做法是，先写一个pfile文件，用pfile启动Oracle实例，然后执行create database语句，创建数据库。建好数据库后，用Oracle提供的脚本导入数据字典和一些官方PL/SQL包。</p>
<p>主要的导入脚本是：</p>
<ul>
	<li><span class="caps">CATALOG</span>.SQL： 创建数据字典和动态性能视图。</li>
	<li><span class="caps">CATPROC</span>.SQL： 创建官方PL/SQL包。</li>
	<li><span class="caps">CATCLUST</span>.SQL： 创建RAC相关视图。</li>
</ul>
<p>在pfile里指定control file文件的位置，指定undo表空间的名字。block大小也在pfile里指定。pfile里指定的一些dump相关目录要先创建好。</p>
<p>在创建数据库的语句里，需要指定system表空间使用的数据文件大小和路径，指定undo表空间的名字和数据文件大小和路径，至少指定两组重做日志的大小和文件路径，10g的库还要指定sysaux表空间使用的数据文件大小和路径。数据库的字符集也需要在创建数据库时指定。默认表空间和默认temp表空间，以及sys和system用户密码也可以在建库语句里指定。</p>
<p>建库语句里，还需要指定一些数据库的限制，比如数据文件最大数量、实例最大数量、重做日志文件最大数量、每组重做日志文件的成员最大数量等。</p>
<p>如果是RAC库，再加一个线程2的两组重做日志，并启用此线程的重做日志。</p>
<h2>详细步骤</h2>
<h3>创建目录</h3>
<div class="highlight"><pre><code class="sql"><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">u01</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">oracle</span><span class="o">/</span><span class="k">admin</span><span class="o">/</span><span class="n">dcs</span><span class="o">/</span><span class="err">{</span><span class="n">adump</span><span class="p">,</span><span class="n">bdump</span><span class="p">,</span><span class="n">cdump</span><span class="p">,</span><span class="n">dpdump</span><span class="p">,</span><span class="n">hdump</span><span class="p">,</span><span class="n">pfile</span><span class="p">,</span><span class="n">udump</span><span class="err">}</span>
</code></pre></div><h3>启动数据库</h3>
<p>pfile的内容，可以随便找一个当前库的修改下就行。</p>
<h3>建库语句</h3>
<div class="highlight"><pre><code class="sql"><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">test</span>
<span class="n">CONTROLFILE</span> <span class="n">REUSE</span>
<span class="n">MAXINSTANCES</span> <span class="mi">32</span>
<span class="n">MAXLOGHISTORY</span> <span class="mi">100</span>
<span class="n">MAXLOGFILES</span> <span class="mi">64</span>
<span class="n">MAXLOGMEMBERS</span> <span class="mi">5</span>
<span class="n">MAXDATAFILES</span> <span class="mi">1024</span>
<span class="n">DATAFILE</span> <span class="s1">&#39;/dev/rdb_system01&#39;</span> <span class="k">SIZE</span> <span class="mi">2046</span><span class="n">M</span> <span class="n">REUSE</span>
<span class="n">SYSAUX</span> <span class="n">DATAFILE</span> <span class="s1">&#39;/dev/rdb_sysaux01&#39;</span><span class="k">SIZE</span> <span class="mi">4094</span><span class="n">M</span> <span class="n">REUSE</span>
<span class="k">TEMPORARY</span> <span class="n">TABLESPACE</span> <span class="n">TEMP</span> <span class="n">TEMPFILE</span> <span class="s1">&#39;/dev/rdb_temp01&#39;</span> <span class="k">SIZE</span> <span class="mi">8190</span><span class="n">M</span> <span class="n">REUSE</span>
<span class="k">DEFAULT</span> <span class="n">TABLESPACE</span> <span class="n">USERS</span> <span class="n">DATAFILE</span> <span class="s1">&#39;/dev/rdb_users01&#39;</span> <span class="k">SIZE</span> <span class="mi">8190</span><span class="n">M</span> <span class="n">REUSE</span><span class="p">;</span>
<span class="n">UNDO</span> <span class="n">TABLESPACE</span> <span class="n">UNDOTBS1</span> <span class="n">DATAFILE</span> <span class="s1">&#39;/dev/rdb_undo11&#39;</span> <span class="k">SIZE</span> <span class="mi">8190</span><span class="n">M</span> <span class="n">REUSE</span>
<span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">ZHS16GBK</span>
<span class="n">LOGFILE</span> <span class="k">GROUP</span> <span class="mi">1</span> <span class="p">(</span><span class="s1">&#39;/dev/rdb_redo111&#39;</span><span class="p">,</span><span class="s1">&#39;/dev/rdb_redo112&#39;</span><span class="p">)</span> <span class="k">SIZE</span> <span class="mi">255</span><span class="n">M</span> <span class="n">REUSE</span><span class="p">,</span>
<span class="k">GROUP</span> <span class="mi">2</span> <span class="p">(</span><span class="s1">&#39;/dev/rdb_redo121&#39;</span><span class="p">,</span><span class="s1">&#39;/dev/rdb_redo122&#39;</span><span class="p">)</span> <span class="k">SIZE</span> <span class="mi">255</span><span class="n">M</span> <span class="n">REUSE</span><span class="p">;</span>
</code></pre></div><h3>执行创建对象的脚本</h3>
<div class="highlight"><pre><code class="sql"><span class="n">conn</span> <span class="n">sys</span><span class="o">/</span><span class="n">change_on_install</span>
<span class="o">@?/</span><span class="n">rdbms</span><span class="o">/</span><span class="k">admin</span><span class="o">/</span><span class="k">catalog</span><span class="p">.</span><span class="k">sql</span><span class="p">;</span>  <span class="c1">-- 数据字典，必选</span>
<span class="o">@?/</span><span class="n">rdbms</span><span class="o">/</span><span class="k">admin</span><span class="o">/</span><span class="n">catproc</span><span class="p">.</span><span class="k">sql</span><span class="p">;</span> <span class="c1">--时间特别长, 必选</span>
<span class="o">@?/</span><span class="n">rdbms</span><span class="o">/</span><span class="k">admin</span><span class="o">/</span><span class="n">catblock</span><span class="p">.</span><span class="k">sql</span><span class="p">;</span> <span class="c1">-- 如果想从一些视图中看到lock的信息运行</span>
<span class="o">@?/</span><span class="n">rdbms</span><span class="o">/</span><span class="k">admin</span><span class="o">/</span><span class="n">catclust</span><span class="p">.</span><span class="k">sql</span><span class="p">;</span> <span class="c1">-- 10g 有关rac的数据字典脚本</span>

<span class="k">connect</span> <span class="k">system</span><span class="o">/</span><span class="n">manager</span>
<span class="o">@?/</span><span class="n">sqlplus</span><span class="o">/</span><span class="k">admin</span><span class="o">/</span><span class="n">pupbld</span><span class="p">.</span><span class="k">sql</span><span class="p">;</span>
<span class="o">@?/</span><span class="n">sqlplus</span><span class="o">/</span><span class="k">admin</span><span class="o">/</span><span class="n">help</span><span class="o">/</span><span class="n">hlpbld</span><span class="p">.</span><span class="k">sql</span> <span class="n">helpus</span><span class="p">.</span><span class="k">sql</span><span class="p">;</span>

<span class="c1">-- 重新编译下所有无效对象</span>
<span class="o">@?/</span><span class="n">rdbms</span><span class="o">/</span><span class="k">admin</span><span class="o">/</span><span class="n">utlrp</span><span class="p">.</span><span class="k">sql</span><span class="p">;</span>
</code></pre></div><h3>创建实例2的重做日志和undo表空间</h3>
<div class="highlight"><pre><code class="sql"><span class="k">ALTER</span> <span class="k">DATABASE</span> <span class="k">ADD</span> <span class="n">LOGFILE</span>
<span class="n">THREAD</span> <span class="mi">2</span> <span class="k">GROUP</span> <span class="mi">3</span> <span class="p">(</span><span class="s1">&#39;/dev/rdb_redo231&#39;</span><span class="p">,</span><span class="s1">&#39;/dev/rdb_redo232&#39;</span><span class="p">)</span> <span class="k">SIZE</span> <span class="mi">255</span><span class="n">M</span> <span class="n">REUSE</span><span class="p">,</span>
<span class="k">GROUP</span> <span class="mi">4</span> <span class="p">(</span><span class="s1">&#39;/dev/rdb_redo241&#39;</span><span class="p">,</span><span class="s1">&#39;/dev/rdb_redo242&#39;</span><span class="p">)</span> <span class="k">SIZE</span> <span class="mi">255</span><span class="n">M</span> <span class="n">REUSE</span><span class="p">;</span>

<span class="k">ALTER</span> <span class="k">DATABASE</span> <span class="n">ENABLE</span> <span class="k">PUBLIC</span> <span class="n">THREAD</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="n">UNDO</span> <span class="n">TABLESPACE</span> <span class="ss">&quot;UNDOTBS2&quot;</span> <span class="n">DATAFILE</span> <span class="s1">&#39;/dev/rdb_undo21&#39;</span> <span class="k">SIZE</span> <span class="mi">8190</span><span class="n">M</span> <span class="n">REUSE</span><span class="p">;</span>
</code></pre></div><h3>创建密码文件</h3>
<div class="highlight"><pre><code class="bash">orapwd <span class="nv">file</span><span class="o">=</span><span class="s1">&#39;/tmp/rdb_pwdfile&#39;</span> <span class="nv">password</span><span class="o">=</span>change_on_instal
dd <span class="k">if</span><span class="o">=</span><span class="s1">&#39;/tmp/rdb_pwdfile&#39;</span> <span class="nv">of</span><span class="o">=</span><span class="s1">&#39;/dev/rdb_pwdfile&#39;</span> <span class="nv">bs</span><span class="o">=</span>4k
ln -s /dev/rdb_pwdfile <span class="nv">$ORACLE_HOME</span>/dbs/orapwdcs1
ln -s /dev/rdb_pwdfile <span class="nv">$ORACLE_HOME</span>/dbs/orapwdcs2
</code></pre></div><h3>注册到CRS</h3>
<div class="highlight"><pre><code class="bash">srvctl add database -d <span class="nb">test</span> -o <span class="nv">$ORACLE_HOME</span> -p /dev/rdb_spfile
srvctl add instance -d <span class="nb">test</span> -i test1 -n testdb1
srvctl add instance -d <span class="nb">test</span> -i test2 -n testdb2
</code></pre></div><h2>总结</h2>
<p>手工建库不难，我觉得比起DBCA建库它还要更加可靠。手工建库虽然稍微复杂点，但可以让你更深入的理解Oracle的运行机制，对DBCA这个工具也会有更深入的理解。比如，我现在就认识到，DBCA其实只是这些命令行的一个图形界面的包装，实际调用的还是跟手工执行的命令一样的脚本。</p>

</div>

<div id="related">
  <h2>Random Posts</h2>
  <ul class="posts">
    
      <li><span>08 Oct 2013</span> &raquo; <a href="/posts/first-post.html">stat</a></li>
    
      <li><span>26 Aug 2013</span> &raquo; <a href="/posts/aix-large-pages.html">Oracle 数据库在 AIX 平台上启用大内存页</a></li>
    
      <li><span>05 Jul 2012</span> &raquo; <a href="/posts/oracle-data-guard-part2.html">Oracle 11g Data Guard 物理备库快速配置指南（下）</a></li>
    
      <li><span>26 Jun 2012</span> &raquo; <a href="/posts/oracle-data-guard-part1.html">Oracle 11g Data Guard 物理备库快速配置指南（上）</a></li>
    
      <li><span>13 Apr 2012</span> &raquo; <a href="/posts/linux-sar.html">Linux 下使用 Sar 简介</a></li>
    
  </ul>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'xlau';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


	  <div id="footer">
  Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a> and <a href="http://twitter.github.com/bootstrap/">Bootstrap</a>.  Last updated at 2013-10-08 14:11:33 +0800.
</div>

	</div>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script src="/assets/js/app.js"></script>
	<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-4770949-2']);
  _gaq.push(['_setDomainName', 'xlau.org']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
      </body>
</html>
